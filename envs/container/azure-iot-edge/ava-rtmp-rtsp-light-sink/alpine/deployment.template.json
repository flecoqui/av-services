{
  "$schema-template": "2.0.0",
  "modulesContent": {
    "$edgeAgent": {
      "properties.desired": {
        "schemaVersion": "1.0",
        "runtime": {
          "type": "docker",
          "settings": {
            "minDockerVersion": "v1.25",
            "loggingOptions": "",
            "registryCredentials": {

              "rtmprtspxkevtz2dnu4umacr": {
                "username": "rtmprtspxkevtz2dnu4umacr",
                "password": "u1GWZro1RnMpg08UObz6h=0vqhJeTvno",
                "address": "rtmprtspxkevtz2dnu4umacr.azurecr.io"
              }
            }
          }
        },
        "systemModules": {
          "edgeAgent": {
            "type": "docker",
            "settings": {
              "image": "mcr.microsoft.com/azureiotedge-agent:1.2",
              "createOptions": "{}"
            }
          },
          "edgeHub": {
            "type": "docker",
            "status": "running",
            "restartPolicy": "always",
            "settings": {
              "image": "mcr.microsoft.com/azureiotedge-hub:1.2",
              "createOptions": "{\"HostConfig\":{\"PortBindings\":{\"5671/tcp\":[{\"HostPort\":\"5671\"}],\"8883/tcp\":[{\"HostPort\":\"8883\"}],\"443/tcp\":[{\"HostPort\":\"443\"}]}}}"
              }
            }
        },
        "modules": {
          "avaedge": {
            "version": "1.0",
            "type": "docker",
            "status": "running",
            "restartPolicy": "always",
            "settings": {
              "image": "mcr.microsoft.com/media/video-analyzer:1",
              "createOptions":"{\"HostConfig\":{\"LogConfig\":{\"Type\":\"\",\"Config\":{\"max-size\":\"10m\",\"max-file\":\"10\"}},\"Binds\":[\"/var/media:/var/media/\",\"/var/lib/azuremediaservices:/var/lib/videoanalyzer\"], \"IpcMode\": \"host\",\"ShmSize\": 1536870912}}"
            }
          },
          "rtmpsource": {
            "version": "1.0",
            "type": "docker",
            "status": "running",
            "restartPolicy": "always",
            "settings": {
              "image": "rtmprtspxkevtz2dnu4umacr.azurecr.io/av-services/av-rtmp-rtsp-sink-alpine:latest",
              "createOptions": "{\"Env\":[\"PORT_RTSP=8554\",\"PORT_RTMP=1935\",\"HOSTNAME=rtmprtspava9260vm.eastus2.cloudapp.azure.com\"],\"HostConfig\":{\"PortBindings\":{\"8554/tcp\":[{\"HostPort\":\"8554\"}],\"1935/tcp\":[{\"HostPort\":\"1935\"}]}}}"
            }
          }
        }
      }
    },
    "$edgeHub": {
      "properties.desired": {
        "schemaVersion": "1.0",
        "routes": {
          "AVAToHub": "FROM /messages/modules/avaedge/outputs/* INTO $upstream"
        },
        "storeAndForwardConfiguration": {
          "timeToLiveSecs": 7200
        }
      }
    },
    "avaedge": {
      "properties.desired": {
        "applicationDataDirectory": "/var/lib/videoanalyzer",
        "ProvisioningToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6IllYTGFSZGJ5dFVOSWxiSzdhbUVIemVLRmpFYyIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJydG1wLXJ0c3AtYXZhLWRldmljZSIsImF1ZCI6WyJodHRwczovL2I0ODc0ZmRhMGFkYjQ1MjFhYzI4YzA0NDhiYjZlYzkzLmVkZ2VhcGkuZWFzdHVzMi52aWRlb2FuYWx5emVyLmF6dXJlLm5ldC9lZGdlTW9kdWxlcy9ydG1wLXJ0c3AtYXZhLWRldmljZSJdLCJleHAiOjE2NDI3ODkyOTgsInRva2VuVHlwZSI6IlByb3Zpc2lvbmluZ1Rva2VuIiwibW9kdWxlQXJtSWQiOiIvc3Vic2NyaXB0aW9ucy9lNWM5ZmM4My1mYmQwLTQzNjgtOWNiNi0xYjU4MjM0NzliNmQvcmVzb3VyY2VHcm91cHMvYXYtcnRtcC1ydHNwLWxpZ2h0LWF2YS1yZy9wcm92aWRlcnMvTWljcm9zb2Z0Lk1lZGlhL3ZpZGVvQW5hbHl6ZXJzL3J0bXBydHNwYXZhOTI2MGF2YS9lZGdlTW9kdWxlcy9ydG1wLXJ0c3AtYXZhLWRldmljZSIsIm1vZHVsZUlkIjoiMGI2NGQzMjktZDkyMS00NGU1LTk3YWQtMTY1MGJlZTM3YmNkIiwiaXNzIjoiaHR0cHM6Ly9lYXN0dXMyLnZpZGVvYW5hbHl6ZXIuYXp1cmUubmV0LyJ9.aHFY9Rca5-e4YTaq2bJWCbJnv7sWgMzBOwtrLuFastGR02CPQZoTYa4QwkfnJS74p4Toa2mwCCU6CjOOhzju_F7qaurV57vFRPYA52ShMLJ80MjV1l6T82M3DBWDkgFpjLIuDIvXYBy6XPzWPUub2Liyy_157bjcyZweP9-cexbz3QeATp9A_nHk0-SY3Kv7rSzn26txyJRLeUtzFbYQAlJS3UkM8oPpdydkKn1cCpYw6gGXyRJwZqFsP43Ff5t4cCNu5zujhpbNThaEl_SPgQfZTBSfPY8AW3ZBhmoMP7QzDtgRXiej-H_MO3bnrS7Ks8fKYtG0zK-SKkCGu2iI8w",
        "diagnosticsEventsOutputName": "diagnostics",
        "operationalEventsOutputName": "operational",
        "logLevel": "information",
        "logCategories": "application, events",
        "allowUnsecuredEndpoints": true,
        "telemetryOptOut": false
      }
    }
  }
}

